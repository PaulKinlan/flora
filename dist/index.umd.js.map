{"version":3,"file":"index.umd.js","sources":["../lib/index.js"],"sourcesContent":["const encoder = new TextEncoder();\n\nconst pipeInto = async (from, controller) => {\n  const reader = from.getReader();\n  \n  return reader.read().then(function process(result) {\n    if (result.done) {\n      return;\n    }\n    const value = result.value;\n    const isTypedArray = (value instanceof Int8Array\n      || value instanceof Int16Array\n      || value instanceof Int32Array\n      || value instanceof Uint8Array\n      || value instanceof Uint8ClampedArray\n      || value instanceof Uint16Array\n      || value instanceof Uint32Array\n      || value instanceof Float32Array\n      || value instanceof Float64Array)\n    if((isTypedArray === false && !!result.value) || (isTypedArray && value.length > 0)) {\n      controller.enqueue(result.value);\n    }\n    return reader.read().then(process);\n  });\n};\n\nconst enqueueItem = async (val, controller) => {\n  if (val instanceof globalThis.ReadableStream) {\n    await pipeInto(val, controller);\n  } \n  else if (val instanceof Promise) {\n    let newVal;\n    newVal = await val;\n\n    if (newVal instanceof globalThis.ReadableStream) {\n      await pipeInto(newVal, controller);\n    } else {\n      await enqueueItem(newVal, controller);\n    }\n  }\n  else {\n    if (Array.isArray(val)) {\n      for (let item of val) {\n        await enqueueItem(item, controller)\n      }\n    }\n    else if (!!val) {\n      controller.enqueue(encoder.encode(val));\n    }\n  }\n}\n\nexport default async (strings, ...values) => {\n  if (\"ReadableStream\" in globalThis === false) {\n    // For node not supporting streams properly..... This should tree-shake away\n    let { ReadableStream } = await import(\"web-streams-polyfill\");\n  }\n  return new globalThis.ReadableStream({\n    start(controller) {\n      async function push() {\n        let i = 0;\n        while (i < values.length) {\n          let html = strings[i];\n          controller.enqueue(encoder.encode(html));\n          await enqueueItem(values[i], controller);\n\n          i++;\n        }\n        controller.enqueue(encoder.encode(strings[i]));\n        controller.close();\n      }\n\n      push();\n    }\n  });\n};"],"names":["Symbol","iterator","_settle","pact","state","value","s","_Pact","o","bind","v","then","observer","prototype","onFulfilled","onRejected","result","this","callback","e","_this","_isSettledPact","thenable","encoder","TextEncoder","pipeInto","from","controller","reader","getReader","read","process","done","isTypedArray","Int8Array","Int16Array","Int32Array","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","Float32Array","Float64Array","length","enqueue","_for","test","update","body","stage","shouldContinue","updateValue","reject","_resumeAfterTest","_resumeAfterBody","_resumeAfterUpdate","enqueueItem","val","globalThis","ReadableStream","newVal","Promise","Array","isArray","target","check","_iteratorSymbol","step","_cycle","next","_fixup","TypeError","values","i","push","array","_forTo","item","encode","strings","start","close","import"],"mappings":"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"}